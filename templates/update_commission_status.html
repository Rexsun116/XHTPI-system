{% extends 'base.html' %}
{% block title %}æ›´æ–°å·¥å‚ç›´å‘è®¢å•çŠ¶æ€ - {{ pi.pi_no }}{% endblock %}
{% block content %}
<div class="container mt-4">
  <!-- é¡µé¢æ ‡é¢˜åŒºåŸŸ -->
  <div class="text-center mb-4">
    <h2 class="display-6 fw-bold text-navy">æ›´æ–°å·¥å‚ç›´å‘è®¢å•çŠ¶æ€</h2>
    <p class="text-muted">PIç¼–å·ï¼š{{ pi.pi_no }} | å½“å‰çŠ¶æ€ï¼š<span class="badge bg-secondary">{{ current_status }}</span></p>
  </div>

  <div class="row justify-content-center">
    <div class="col-lg-10">
      <form method="post">
        <!-- çŠ¶æ€é€‰æ‹©å¡ç‰‡ -->
        <div class="card shadow-sm mb-4">
          <div class="card-header bg-primary text-white">
            <h5 class="mb-0"><i class="fas fa-arrow-right me-2"></i>å·¥å‚ç›´å‘è®¢å•çŠ¶æ€æ›´æ–°</h5>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="new_status" class="form-label">ä¸‹ä¸€æ­¥çŠ¶æ€ <span class="text-danger">*</span></label>
                <select class="form-select" id="new_status" name="new_status" required>
                  {% for status in next_status_options %}
                  <option value="{{ status }}">{{ status }}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="col-md-6 mb-3">
                <label for="remarks" class="form-label">å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰</label>
                <textarea class="form-control" id="remarks" name="remarks" rows="3" placeholder="å¦‚éœ€è®°å½•åŸå› å¯å¡«å†™..."></textarea>
              </div>
            </div>
          </div>
        </div>

        <!-- ğŸ§­ æ–°å»º â†’ å¾…å‘è¿ çŠ¶æ€å­—æ®µ -->
        <div id="pre-shipment-block" class="status-block">
          <!-- å‘è¿å‡†å¤‡ä¿¡æ¯å¡ç‰‡ -->
          <div class="card shadow-sm mb-4">
            <div class="card-header bg-info text-white">
              <h5 class="mb-0"><i class="fas fa-ship me-2"></i>å‘è¿å‡†å¤‡ä¿¡æ¯</h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">è´§ä»£å…¬å¸</label>
                  <select class="form-select" name="freight_forwarder_id">
                    <option value="">è¯·é€‰æ‹©è´§ä»£</option>
                    {% for ff in freight_forwarders %}
                    <option value="{{ ff.id }}" {% if pi.freight_forwarder_id == ff.id %}selected{% endif %}>
                      {{ ff.code }} - {{ ff.name }}
                    </option>
                    {% endfor %}
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">æµ·è¿è´¹</label>
                  <input type="number" step="0.01" class="form-control" name="ocean_freight" value="{{ pi.ocean_freight or '' }}">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">è£…æŸœæ—¶é—´</label>
                  <input type="date" class="form-control" name="container_date" value="{{ pi.container_date or '' }}">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">è£…æŸœåœ°å€</label>
                  <input type="text" class="form-control" name="container_location" value="{{ pi.container_location or '' }}">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">ETD</label>
                  <input type="date" class="form-control" name="etd" value="{{ pi.etd or '' }}">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">ETA</label>
                  <input type="date" class="form-control" name="eta" value="{{ pi.eta or '' }}">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">äº§åœ°è¯ï¼ˆCOOï¼‰</label>
                  <select class="form-select" name="coo_required">
                    <option value="">è¯·é€‰æ‹©</option>
                    <option value="éœ€è¦" {% if pi.coo_required == 'éœ€è¦' %}selected{% endif %}>éœ€è¦</option>
                    <option value="ä¸éœ€è¦" {% if pi.coo_required == 'ä¸éœ€è¦' %}selected{% endif %}>ä¸éœ€è¦</option>
                    <option value="å·²å®Œæˆ" {% if pi.coo_required == 'å·²å®Œæˆ' %}selected{% endif %}>å·²å®Œæˆ</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">äº§åœ°è¯ï¼ˆAPTAï¼‰</label>
                  <select class="form-select" name="apta_required">
                    <option value="">è¯·é€‰æ‹©</option>
                    <option value="éœ€è¦" {% if pi.apta_required == 'éœ€è¦' %}selected{% endif %}>éœ€è¦</option>
                    <option value="ä¸éœ€è¦" {% if pi.apta_required == 'ä¸éœ€è¦' %}selected{% endif %}>ä¸éœ€è¦</option>
                    <option value="å·²å®Œæˆ" {% if pi.apta_required == 'å·²å®Œæˆ' %}selected{% endif %}>å·²å®Œæˆ</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">å‡ºå£è®¸å¯è¯</label>
                  <select class="form-select" name="export_license_required">
                    <option value="">è¯·é€‰æ‹©</option>
                    <option value="éœ€è¦" {% if pi.export_license_required == 'éœ€è¦' %}selected{% endif %}>éœ€è¦</option>
                    <option value="ä¸éœ€è¦" {% if pi.export_license_required == 'ä¸éœ€è¦' %}selected{% endif %}>ä¸éœ€è¦</option>
                    <option value="å·²å®Œæˆ" {% if pi.export_license_required == 'å·²å®Œæˆ' %}selected{% endif %}>å·²å®Œæˆ</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">æŠ¥å…³æ–‡ä»¶</label>
                  <select class="form-select" name="customs_docs_required">
                    <option value="">è¯·é€‰æ‹©</option>
                    <option value="éœ€è¦" {% if pi.customs_docs_required == 'éœ€è¦' %}selected{% endif %}>éœ€è¦</option>
                    <option value="ä¸éœ€è¦" {% if pi.customs_docs_required == 'ä¸éœ€è¦' %}selected{% endif %}>ä¸éœ€è¦</option>
                    <option value="å·²å®Œæˆ" {% if pi.customs_docs_required == 'å·²å®Œæˆ' %}selected{% endif %}>å·²å®Œæˆ</option>
                  </select>
                </div>
                <div class="col-md-12 mb-3">
                  <label class="form-label">å…¶ä»–æ–‡ä»¶</label>
                  <input type="text" class="form-control" name="other_documents" value="{{ pi.other_documents or '' }}">
                </div>
              </div>
            </div>
          </div>

          <!-- æ‰˜ä¹¦ä¿¡æ¯å¡ç‰‡ -->
          <div class="card shadow-sm mb-4">
            <div class="card-header bg-warning text-dark">
              <h5 class="mb-0"><i class="fas fa-file-alt me-2"></i>æ‰˜ä¹¦ä¿¡æ¯</h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">èˆªå/èˆªæ¬¡</label>
                  <input type="text" class="form-control" name="vessel_info" value="{{ pi.vessel_info or '' }}">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">è®¢èˆ±å·ç </label>
                  <input type="text" class="form-control" name="booking_number" value="{{ pi.booking_number or '' }}">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">ç®±å‹å’Œç®±é‡</label>
                  <select class="form-select" name="container_type_quantity">
                    <option value="">è¯·é€‰æ‹©</option>
                    <option value="1*20GP" {% if pi.container_type_quantity == '1*20GP' %}selected{% endif %}>1*20GP</option>
                    <option value="2*20GP" {% if pi.container_type_quantity == '2*20GP' %}selected{% endif %}>2*20GP</option>
                    <option value="3*20GP" {% if pi.container_type_quantity == '3*20GP' %}selected{% endif %}>3*20GP</option>
                    <option value="1*40GP" {% if pi.container_type_quantity == '1*40GP' %}selected{% endif %}>1*40GP</option>
                    <option value="2*40GP" {% if pi.container_type_quantity == '2*40GP' %}selected{% endif %}>2*40GP</option>
                    <option value="1*40HQ" {% if pi.container_type_quantity == '1*40HQ' %}selected{% endif %}>1*40HQ</option>
                    <option value="2*40HQ" {% if pi.container_type_quantity == '2*40HQ' %}selected{% endif %}>2*40HQ</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">SHIPPING MARK</label>
                  <select class="form-select" name="shipping_mark">
                    <option value="N/M" {% if pi.shipping_mark == 'N/M' %}selected{% endif %}>N/M</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">è¿è¾“æ¡æ¬¾</label>
                  <select class="form-select" name="freight_term">
                    <option value="CY-CY" {% if pi.freight_term == 'CY-CY' %}selected{% endif %}>CY-CY</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">çº¦å·</label>
                  <input type="text" class="form-control" name="contract_number" value="{{ pi.contract_number or '' }}">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">è¿è´¹æ¡æ¬¾</label>
                  <input type="text" class="form-control" name="freight_clause" value="{{ pi.freight_clause or '' }}">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">æ­£æœ¬/WAYBILL</label>
                  <select class="form-select" name="waybill_option">
                    <option value="ç­‰é€šçŸ¥ç”µæ”¾" {% if pi.waybill_option == 'ç­‰é€šçŸ¥ç”µæ”¾' %}selected{% endif %}>ç­‰é€šçŸ¥ç”µæ”¾</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">ç®±å·</label>
                  <input type="text" class="form-control" name="container_number" value="{{ pi.container_number or '' }}">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">å°å·</label>
                  <input type="text" class="form-control" name="seal_number" value="{{ pi.seal_number or '' }}">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">ç®±å‹</label>
                  <select class="form-select" name="container_type">
                    <option value="20GP" {% if pi.container_type == '20GP' %}selected{% endif %}>20GP</option>
                    <option value="40GP" {% if pi.container_type == '40GP' %}selected{% endif %}>40GP</option>
                    <option value="40HQ" {% if pi.container_type == '40HQ' %}selected{% endif %}>40HQ</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">ä»¶æ•°</label>
                  <input type="number" step="1" class="form-control" name="quantity_units" value="{{ pi.quantity_units or '' }}">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">æ¯›é‡</label>
                  <input type="number" step="0.01" class="form-control" name="gross_weight" value="{{ pi.gross_weight or '' }}">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">ä½“ç§¯</label>
                  <input type="number" step="0.01" class="form-control" name="volume" value="{{ pi.volume or '' }}">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">VGM</label>
                  <input type="text" class="form-control" name="vgm" value="{{ pi.vgm or '' }}">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">æ€»è®¡ä»¶æ•°</label>
                  <input type="number" step="1" class="form-control" name="total_quantity" value="{{ pi.total_quantity or '' }}">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">æ€»è®¡ä»¶æ•°å•ä½</label>
                  <select class="form-select" name="total_quantity_unit">
                    <option value="BAGS" {% if pi.total_quantity_unit == 'BAGS' %}selected{% endif %}>BAGS</option>
                    <option value="PALLETS" {% if pi.total_quantity_unit == 'PALLETS' %}selected{% endif %}>PALLETS</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">æ€»è®¡æ¯›é‡</label>
                  <input type="number" step="0.01" class="form-control" name="total_weight" value="{{ pi.total_weight or '' }}">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">æ€»è®¡æ¯›é‡å•ä½</label>
                  <select class="form-select" name="total_weight_unit">
                    <option value="KGS" {% if pi.total_weight_unit == 'KGS' %}selected{% endif %}>KGS</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">æ€»è®¡ä½“ç§¯</label>
                  <input type="number" step="0.01" class="form-control" name="total_volume" value="{{ pi.total_volume or '' }}">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">æ€»è®¡ä½“ç§¯å•ä½</label>
                  <select class="form-select" name="total_volume_unit">
                    <option value="CBM" {% if pi.total_volume_unit == 'CBM' %}selected{% endif %}>CBM</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">æ€»è®¡VGM</label>
                  <input type="text" class="form-control" name="total_vgm" value="{{ pi.total_vgm or '' }}">
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ğŸ“¦ å¾…å‘è¿ â†’ å·²å‘è¿ çŠ¶æ€å­—æ®µ -->
        <div id="shipped-block" class="status-block">
          <!-- å‘è¿ç¡®è®¤ä¿¡æ¯å¡ç‰‡ -->
          <div class="card shadow-sm mb-4">
            <div class="card-header bg-success text-white">
              <h5 class="mb-0"><i class="fas fa-shipping-fast me-2"></i>å‘è¿ç¡®è®¤ä¿¡æ¯</h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">æå•å· <span class="text-danger">*</span></label>
                  <input type="text" class="form-control" name="bill_of_lading" value="{{ pi.bill_of_lading or '' }}" required>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">èˆ¹å…¬å¸</label>
                  <input type="text" class="form-control" name="shipping_company" value="{{ pi.shipping_company or '' }}">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">å®é™…å‘è¿æ—¥æœŸ</label>
                  <input type="date" class="form-control" name="actual_departure_date" value="{{ pi.actual_departure_date or '' }}">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">æ‰¹å·ï¼ˆå¤šä¸ªç”¨è‹±æ–‡åˆ†å· ; åˆ†éš”ï¼‰</label>
                  <input type="text" class="form-control" name="batch_no" value="{{ pi.batch_no or '' }}">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">COAè´¨æ£€å•</label>
                  <select class="form-select" name="coa_status">
                    <option value="">è¯·é€‰æ‹©</option>
                    <option value="éœ€è¦" {% if pi.coa_status == 'éœ€è¦' %}selected{% endif %}>éœ€è¦</option>
                    <option value="ä¸éœ€è¦" {% if pi.coa_status == 'ä¸éœ€è¦' %}selected{% endif %}>ä¸éœ€è¦</option>
                    <option value="å·²å®Œæˆ" {% if pi.coa_status == 'å·²å®Œæˆ' %}selected{% endif %}>å·²å®Œæˆ</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">ä¿é™©å•</label>
                  <select class="form-select" name="insurance_status">
                    <option value="">è¯·é€‰æ‹©</option>
                    <option value="éœ€è¦" {% if pi.insurance_status == 'éœ€è¦' %}selected{% endif %}>éœ€è¦</option>
                    <option value="ä¸éœ€è¦" {% if pi.insurance_status == 'ä¸éœ€è¦' %}selected{% endif %}>ä¸éœ€è¦</option>
                    <option value="å·²å®Œæˆ" {% if pi.insurance_status == 'å·²å®Œæˆ' %}selected{% endif %}>å·²å®Œæˆ</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">åŸä»¶é‚®å¯„çŠ¶æ€</label>
                  <select class="form-select" name="document_shipping_status" id="document_shipping_status" onchange="toggleTrackingNumber(this)">
                    <option value="">è¯·é€‰æ‹©</option>
                    <option value="å·²é‚®å¯„" {% if pi.document_shipping_status == 'å·²é‚®å¯„' %}selected{% endif %}>å·²é‚®å¯„</option>
                    <option value="æœªé‚®å¯„" {% if pi.document_shipping_status == 'æœªé‚®å¯„' %}selected{% endif %}>æœªé‚®å¯„</option>
                    <option value="ä¸éœ€è¦" {% if pi.document_shipping_status == 'ä¸éœ€è¦' %}selected{% endif %}>ä¸éœ€è¦</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3" id="tracking_number_div" style="display: {% if pi.document_shipping_status == 'å·²é‚®å¯„' %}block{% else %}none{% endif %};">
                  <label class="form-label">é‚®å¯„å•å·</label>
                  <input type="text" class="form-control" name="tracking_number" value="{{ pi.tracking_number or '' }}">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">è´§æ¬¾æ”¶é½çŠ¶æ€</label>
                  <select class="form-select" name="payment_received">
                    <option value="">è¯·é€‰æ‹©</option>
                    <option value="å·²æ”¶é½" {% if pi.payment_received == 'å·²æ”¶é½' %}selected{% endif %}>å·²æ”¶é½</option>
                    <option value="æœªæ”¶é½" {% if pi.payment_received == 'æœªæ”¶é½' %}selected{% endif %}>æœªæ”¶é½</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">ç»“æ±‡æ–‡ä»¶éœ€æ±‚</label>
                  <select class="form-select" name="settlement_documents_required">
                    <option value="">è¯·é€‰æ‹©</option>
                    <option value="éœ€è¦" {% if pi.settlement_documents_required == 'éœ€è¦' %}selected{% endif %}>éœ€è¦</option>
                    <option value="ä¸éœ€è¦" {% if pi.settlement_documents_required == 'ä¸éœ€è¦' %}selected{% endif %}>ä¸éœ€è¦</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ğŸš¢ å·²å‘è¿ â†’ å·²åˆ°æ¸¯ çŠ¶æ€å­—æ®µ -->
        <div id="arrived-block" class="status-block">
          <!-- åˆ°æ¸¯ç¡®è®¤ä¿¡æ¯å¡ç‰‡ -->
          <div class="card shadow-sm mb-4">
            <div class="card-header bg-info text-white">
              <h5 class="mb-0"><i class="fas fa-anchor me-2"></i>åˆ°æ¸¯ç¡®è®¤ä¿¡æ¯</h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">å®é™…åˆ°æ¸¯æ—¥æœŸ <span class="text-danger">*</span></label>
                  <input type="date" class="form-control" name="actual_arrival_date" value="{{ pi.actual_arrival_date or '' }}" required>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">è´§æ¬¾æ”¶é½çŠ¶æ€</label>
                  <select class="form-select" name="payment_received">
                    <option value="">è¯·é€‰æ‹©</option>
                    <option value="å·²æ”¶é½" {% if pi.payment_received == 'å·²æ”¶é½' %}selected{% endif %}>å·²æ”¶é½</option>
                    <option value="æœªæ”¶é½" {% if pi.payment_received == 'æœªæ”¶é½' %}selected{% endif %}>æœªæ”¶é½</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">è´§ä»£è´¦å•é‡‘é¢</label>
                  <input type="number" step="0.01" class="form-control" name="freight_invoice_amount" value="{{ pi.freight_invoice_amount or '' }}">
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">è´§ä»£è´¦å•ç¡®è®¤çŠ¶æ€</label>
                  <select class="form-select" name="freight_invoice_confirmed">
                    <option value="">è¯·é€‰æ‹©</option>
                    <option value="å·²ç¡®è®¤" {% if pi.freight_invoice_confirmed == 'å·²ç¡®è®¤' %}selected{% endif %}>å·²ç¡®è®¤</option>
                    <option value="æœªç¡®è®¤" {% if pi.freight_invoice_confirmed == 'æœªç¡®è®¤' %}selected{% endif %}>æœªç¡®è®¤</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">è´§ä»£å‘ç¥¨å¼€å…·çŠ¶æ€</label>
                  <select class="form-select" name="freight_invoice_issued">
                    <option value="">è¯·é€‰æ‹©</option>
                    <option value="å·²å¼€å…·" {% if pi.freight_invoice_issued == 'å·²å¼€å…·' %}selected{% endif %}>å·²å¼€å…·</option>
                    <option value="æœªå¼€å…·" {% if pi.freight_invoice_issued == 'æœªå¼€å…·' %}selected{% endif %}>æœªå¼€å…·</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label class="form-label">PIç”µæ”¾çŠ¶æ€</label>
                  <select class="form-select" name="telex_release">
                    <option value="">è¯·é€‰æ‹©</option>
                    <option value="å·²ç”µæ”¾" {% if pi.telex_release == 'å·²ç”µæ”¾' %}selected{% endif %}>å·²ç”µæ”¾</option>
                    <option value="æœªç”µæ”¾" {% if pi.telex_release == 'æœªç”µæ”¾' %}selected{% endif %}>æœªç”µæ”¾</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- âœ… å·²åˆ°æ¸¯ â†’ å·²å®Œæˆ çŠ¶æ€å­—æ®µ -->
        <div id="completed-block" class="status-block">
          <!-- å®Œæˆç¡®è®¤ä¿¡æ¯å¡ç‰‡ -->
          <div class="card shadow-sm mb-4">
            <div class="card-header bg-success text-white">
              <h5 class="mb-0"><i class="fas fa-check-circle me-2"></i>å®Œæˆç¡®è®¤ä¿¡æ¯</h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-4 mb-3">
                  <label class="form-label">è´§æ¬¾æ”¶é½çŠ¶æ€ <span class="text-danger">*</span></label>
                  <select class="form-select" name="payment_received" required>
                    <option value="">è¯·é€‰æ‹©</option>
                    <option value="å·²æ”¶é½" {% if pi.payment_received == 'å·²æ”¶é½' %}selected{% endif %}>å·²æ”¶é½</option>
                    <option value="æœªæ”¶é½" {% if pi.payment_received == 'æœªæ”¶é½' %}selected{% endif %}>æœªæ”¶é½</option>
                  </select>
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">è´§ä»£è¿è´¹ä»˜æ¬¾çŠ¶æ€ <span class="text-danger">*</span></label>
                  <select class="form-select" name="freight_payment_status" required>
                    <option value="">è¯·é€‰æ‹©</option>
                    <option value="å·²ä»˜æ¬¾" {% if pi.freight_payment_status == 'å·²ä»˜æ¬¾' %}selected{% endif %}>å·²ä»˜æ¬¾</option>
                    <option value="æœªä»˜æ¬¾" {% if pi.freight_payment_status == 'æœªä»˜æ¬¾' %}selected{% endif %}>æœªä»˜æ¬¾</option>
                  </select>
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label">ä½£é‡‘ç»“ç®—çŠ¶æ€ <span class="text-danger">*</span></label>
                  <select class="form-select" name="commission_status" required>
                    <option value="">è¯·é€‰æ‹©</option>
                    <option value="å·²ç»“ç®—" {% if pi.commission_status == 'å·²ç»“ç®—' %}selected{% endif %}>å·²ç»“ç®—</option>
                    <option value="æœªç»“ç®—" {% if pi.commission_status == 'æœªç»“ç®—' %}selected{% endif %}>æœªç»“ç®—</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div class="d-grid gap-2 d-md-flex justify-content-md-end mb-4">
          <a href="{{ url_for('commission_pi_list') }}" class="btn btn-secondary me-md-2">å–æ¶ˆ</a>
          <button type="submit" class="btn btn-primary">æ›´æ–°çŠ¶æ€</button>
        </div>
      </form>
    </div>
  </div>
</div>

<style>
  /* è‡ªå®šä¹‰é¢œè‰²å˜é‡ */
  :root {
    --navy-blue: #1e3a8a;
    --light-navy: #3b82f6;
    --accent-color: #f59e0b;
    --light-gray: #f8fafc;
    --medium-gray: #e2e8f0;
    --dark-gray: #64748b;
  }

  /* æ–‡å­—é¢œè‰² */
  .text-navy { color: var(--navy-blue) !important; }
  .text-accent { color: var(--accent-color) !important; }
  
  /* èƒŒæ™¯é¢œè‰² */
  .bg-navy { background-color: var(--navy-blue) !important; }
  .bg-light-gray { background-color: var(--light-gray) !important; }
  .bg-accent { background-color: var(--accent-color) !important; }

  /* çŠ¶æ€å—æ ·å¼ */
  .status-block {
    display: none;
  }

  /* å“åº”å¼è°ƒæ•´ */
  @media (max-width: 768px) {
    .display-6 {
      font-size: 1.5rem;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const statusSelect = document.getElementById('new_status');
    const blockPreShipment = document.getElementById('pre-shipment-block');
    const blockShipped = document.getElementById('shipped-block');
    const blockArrived = document.getElementById('arrived-block');
    const blockCompleted = document.getElementById('completed-block');
    const documentShippingStatusSelect = document.getElementById('document_shipping_status');
    const trackingNumberDiv = document.getElementById('tracking_number_div');

    function updateFormDisplay() {
      const selected = statusSelect.value;
      blockPreShipment.style.display = selected === 'å¾…å‘è¿' ? 'block' : 'none';
      blockShipped.style.display = selected === 'å·²å‘è¿' ? 'block' : 'none';
      blockArrived.style.display = selected === 'å·²åˆ°æ¸¯' ? 'block' : 'none';
      blockCompleted.style.display = selected === 'å·²å®Œæˆ' ? 'block' : 'none';

      // ç¦ç”¨éšè—åŒºå—çš„è¡¨å•å…ƒç´ 
      const isVisible = blockPreShipment.style.display === 'block';
      blockPreShipment.querySelectorAll('input, select, textarea').forEach(input => {
        input.disabled = !isVisible;
      });

      const isShippedVisible = blockShipped.style.display === 'block';
      blockShipped.querySelectorAll('input, select, textarea').forEach(input => {
        input.disabled = !isShippedVisible;
      });

      const isArrivedVisible = blockArrived.style.display === 'block';
      blockArrived.querySelectorAll('input, select, textarea').forEach(input => {
        input.disabled = !isArrivedVisible;
      });

      const isCompletedVisible = blockCompleted.style.display === 'block';
      blockCompleted.querySelectorAll('input, select, textarea').forEach(input => {
        input.disabled = !isCompletedVisible;
      });
    }

    function toggleTrackingNumber(select) {
      const isSelected = select.value === 'å·²é‚®å¯„';
      trackingNumberDiv.style.display = isSelected ? 'block' : 'none';
    }

    statusSelect.addEventListener('change', updateFormDisplay);
    updateFormDisplay(); // åˆå§‹åŒ–ä¸€æ¬¡
  });
</script>
{% endblock %} 